# Polymarket 市场数据结构详解

本文档基于 Gamma API (`/markets?slug=...`) 返回的 JSON 结构进行深度解析。
该数据结构是 **"Theta Eater" (15m 超短线策略)** 的核心数据源。

---

## 1. 核心字段 (Critical Fields)
*这些字段在我们的策略中起着决定性作用，任何一个出错都会导致策略失效或亏损。*

### 🆔 身份标识
*   **`conditionId`** (String)
    *   **含义**: 市场的唯一合约标识符 (CTF Condition ID)。
    *   **重要性**: ⭐⭐⭐⭐⭐
    *   **用途**: 虽然我们通常用 `clobTokenIds` 下单，但这个 ID 是链接所有链上数据的根。
*   **`clobTokenIds`** (Array of Strings)
    *   **含义**: 包含 outcomes 对应的 Token ID 数组。通常 `[0]` 是 "Yes/Up"，`[1]` 是 "No/Down"。
    *   **重要性**: ⭐⭐⭐⭐⭐
    *   **用途**: **下单必须**。调用 `createOrder` 时，必须传入这里的 Token ID（特别是我们做空时要买的 Token 1）。
    *   **注意**: 这是一个 JSON 字符串数组，使用前需 `JSON.parse()`。

### ⏳ 时间与生命周期
*   **`endDateIso`** / **`endDate`** (ISO 8601 String)
    *   **含义**: 市场结束（到期）的时间。
    *   **重要性**: ⭐⭐⭐⭐⭐
    *   **用途**: 计算 `timeLeft` (剩余时间)。我们的策略极其依赖 "剩余 2-5 分钟" 这个窗口。如果取错了时间，你会买入一个还有 1 小时才结束的单子，Theta 还没衰减，毫无优势。
*   **`active`** (Boolean) & **`closed`** (Boolean)
    *   **含义**: 市场是否开放交易 / 是否已结算。
    *   **重要性**: ⭐⭐⭐⭐⭐
    *   **用途**: 过滤条件。必须是 `active: true` 且 `closed: false`。

### 📜 规则与裁决
*   **`question`** (String)
    *   **含义**: 市场标题，如 "Ethereum Up or Down - February 5..."。
    *   **重要性**: ⭐⭐⭐⭐
    *   **用途**: 用于正则匹配提取 **Strike Price (行权价)**。虽然 15m 市场通常是 "Up/Down" 类型（比较开始和结束价格），但对于 "Price > $2500" 类型，必须从这里提取数字。
*   **`resolutionSource`** (String / URL)
    *   **含义**: 裁决数据源。例如 `https://data.chain.link/streams/eth-usd`。
    *   **重要性**: ⭐⭐⭐⭐⭐
    *   **用途**: **风控核心**。如果是 Chainlink，我们就要参考 Chainlink 的预言机价格；如果是 Binance，就看 Binance。不同源的价差是最大的风险点。
*   **`description`** (String)
    *   **含义**: 详细规则描述。
    *   **重要性**: ⭐⭐⭐
    *   **用途**: 人工复核时必看。机器一般只解析结构化字段。

---

## 2. 交易辅助字段 (Trading Aux)
*用于判断市场流动性和计算潜在利润。*

*   **`outcomePrices`** (JSON Array)
    *   **含义**: 当前的市场概算价格（通常是上一次成交价或中间价）。
    *   **重要性**: ⭐⭐⭐
    *   **用途**: 快速估算。但**不要用它下单**！下单前必须实时去查 Orderbook (CLOB) 的 Ask/Bid，因为这个字段有延迟。
*   **`liquidity`** / **`liquidityClob`** (String/Number)
    *   **含义**: 市场流动性池深度。
    *   **重要性**: ⭐⭐
    *   **用途**: 过滤掉流动性枯竭的僵尸市场。如果 `liquidity < 100`，滑点会吃光你的利润。
*   **`enableOrderBook`** (Boolean)
    *   **含义**: 是否启用 CLOB 交易。
    *   **重要性**: ⭐⭐⭐⭐⭐
    *   **用途**: 必须为 `true`。我们的 SDK 只能在启用 CLOB 的市场上工作。

---

## 3. 信息类字段 (Informational)
*用于展示或日志记录，不影响策略逻辑。*

*   `slug`: URL 友好的标识符 (`eth-updown-15m-1770280200`)。我们用它来反推 API 地址。
*   `volume`: 总交易量。
*   `image` / `icon`: 图标 URL。
*   `createdAt` / `updatedAt`: 创建/更新时间。

---

## 4. ⚠️ 策略中的特殊注意事项 (Gotchas)

### A. Token ID 的顺序
`outcomes` 字段通常是 `["Up", "Down"]` 或 `["Yes", "No"]`。
`clobTokenIds` 数组的顺序严格对应 `outcomes`。
*   **Token[0]** = Up / Yes
*   **Token[1]** = Down / No
**策略应用**: 我们的 "Theta Eater" 策略通常是**买入 No** (赌不会发生)，所以代码中要硬编码取 `clobTokenIds[1]`。如果市场结构变了（比如变成 3 个选项），代码会崩，需加防守逻辑。

### B. 价格类型 (Up/Down vs Price Target)
*   **Price Target**: "Will ETH be > $2500?" -> 这是一个绝对值比较。
*   **Up/Down**: "Will ETH be Up or Down?" -> 这是一个相对值比较（End Price >= Start Price）。
    *   **注意**: 这种市场的 Strike Price 不是固定的数字，而是 `Start Price`（隐含在 `description` 或其他字段中，或者就是该时间段开始时的价格）。
    *   **策略调整**: 对于 Up/Down 市场，我们的策略需要知道 **Start Price** 是多少。但在 API 中这个值可能没有直接给，需要去查 `events[0].startDate` 那一刻的币价。这比固定行权价更复杂，建议新手先只做 "Price > $X" 类型，或者手动确认 Up/Down 的基准线。

---
*Generated by Atlas for Polymarket-Trading Project*
